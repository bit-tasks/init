name: Docker Init Test

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    container:
      image: bitsrc/stable:latest
      options: --user root
    timeout-minutes: 20
    env:
      BIT_CONFIG_ACCESS_TOKEN: ${{ secrets.BIT_CONFIG_ACCESS_TOKEN }}
      NODE_OPTIONS: --max-old-space-size=6656 # set max old space size to 6.5GiB, GitHub hosted runners have 7GiB
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Debug - Check current directory
        run: pwd

      - name: Debug - List root directory
        run: ls -alh /

      - name: Debug - List home directory
        run: ls -alh /home

      - name: Debug - List workspace directory
        run: ls -alh /__w

      - name: Debug - List repository directory
        run: ls -alh /__w/init/init

      - name: Initialize Bit
        uses: bit-tasks/init@main
        with:
          ws-dir: "test-data"
          log: "trace"
